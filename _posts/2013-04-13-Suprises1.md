---
layout: post
title: Surprises in Symbolic Computing - Complex Branch Cuts
---

# Suprises in Symbolic Computing - Complex Branch Cuts

-----

This is a topic I hope to revisit pretty often. The traps and pitfalls of symbolic methods can be as tricky as numerical methods, but even the basic ones get little attention.

For this post I would like to cover issues with [functions that have branches](https://en.wikipedia.org/wiki/Principal_branch). These are functions that could represent multiple values. As an example, consider the square root function. We could say that \\(\sqrt{4}\\) is either 2 or -2. There are two "branchs" that we could choose here. We normally choose it to mean the positive branch (+2), but in some cases it may be helpful to interpret it as (-2). This is a serious ambiguity in our notation. 

Inverse trigonometric functions are especially troublesome - they have many branchs to choose from. The Sine function is equal to zero for an infinitely many values.

$$ 0 = sin(0) = sin(\pi) = sin(2 \pi) ... $$

So, \\(arcsin(0)\\) can have an infinite number of values. We choose one of these branchs by convention. When doing algebra, it is important to choose the correct value based on what we intend \(arcsin\) to mean.

The correct choice of which branch to take is often just not even encoded in the equation. It's implicit - not explicit. Without this information, symbolic solvers have to choose a default branch cut to take. Even more frustrating, sometimes different solvers or books don't even agree on which branch to take. 

## A Simple Differential Equation Gone Wrong

-----

Consider this differential equation:

$$ \sqrt{f'(x)} = -x $$

We could solve it like this:

$$ f'(x) = x^2 $$

$$ f(x) = \frac{x^3}{3}+c $$

[This is exactly what a symbolic solver will do with this equation.](http://www.wolframalpha.com/input/?i=Sqrt%5Bf%27%5Bx%5D%5D+%3D%3D+-x)

This solution doesn't satisfy the original equation unless we note down that the square root is meant to take the negative branch. Unfortunately, any solver is going to take positive branch instead. 

This is just one of the simplest examples of these problems. With larger equations, tracking down the incorrect branch is a nightmare. Sometimes it isn't even clear whether an incorrect branch is even the cause or not.

![A tree](https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/PS_dub_u_Bu%C5%A1e%2C_pohled_do_koruny.jpg/320px-PS_dub_u_Bu%C5%A1e%2C_pohled_do_koruny.jpg)

## When the Fundamental Theorem of Calculus Fails

-----

This example is taken from an [excellent post in Wolfram Research's Blog](http://blog.wolfram.com/2011/11/08/mathematica-qa-series-surprises-in-differentiation-and-integration/). 

The [fundamental theorem of calculus](https://en.wikipedia.org/wiki/Fundamental_theorem_of_calculus) says that integration and differentiation should undo each other. However, consider the example using a logarithm below. Logarithms, like a lot of inverse functions, have branch cuts.

$$ \frac{\partial \log (-x)}{\partial x} = \frac{1}{x} $$

So if we integrate \\(1/x\\), we should get the original function, \\(\log(-x)\\), right? Nope.

$$ \int \frac{1}{x} \, dx = \log (x) $$

The functions \\(\log(x)\\) and \\(\log(-x)\\) aren't the same. Notice that we didn't need to use complex numbers anywhere to see this issue. It's commonly believed that branch cuts will never be an issue if you stay away from complex numbers. This isn't the case.  

When the fundamental theorem of calculus appears to fail in symbolic computing, branch cuts are almost always the cause. Fortunately, there is a good test to see if this is the case. Because branch cuts change the value of a function by adding a constant complex value, we should get a [piecewise constant function when subtracting the expected result from the result we get back](https://www.wolframalpha.com/input/?i=log%5B-x%5D-log%5Bx%5D). This is a simple test to see if branch cuts are the culprit. 
